import{d as de,r as c,j as e,C as De}from"./index-DUfxMsBG.js";import{c as g,d as u,a as j,e as x,b as Ee,g as Pe}from"./auth-q2UnZPLo.js";import{C as Ie,a as Te,b as Je,c as Oe,d as w,f as Q,e as Me,h as X,g as Ae}from"./cil-trash-2s-ugeRC.js";import{C as Fe,a as _}from"./CFormInput-Cbdb-K5P.js";import{C as Le}from"./CFormTextarea-DH0Xj6EK.js";import{C as Z,a as ee}from"./CCardBody-llveuZcH.js";import{C as Re}from"./CCardHeader-BnOoQjEp.js";import{m as le,j as ce}from"./DefaultLayout-DP4gFdW4.js";import{C as ke,a as He,b as oe,c as v,d as ze,e as b}from"./CTable-RJjthtCV.js";import{c as $e}from"./cil-calendar-B69zOQSH.js";const me="mock_judicial_notifications_v1",G=[{id:1,case_number:"CASE-2024-001",case_title:"Robo en vía pública",case_description:"Caso de robo de celular en centro comercial",judge_id:2,judge_name:"Carlos Rodríguez",court:"Juzgado Primero Penal",hearing_date:"2024-02-15",hearing_time:"09:00",trial_date:"2024-03-20",trial_time:"10:00",location:"Palacio de Justicia, Sala 4A",status:"programado",priority:"alta",created_by:1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}];function se(){try{const a=localStorage.getItem(me);if(!a)return te(G),G;const o=JSON.parse(a);return o&&o.length>0?o:G}catch(a){return console.error("Error loading notifications:",a),G}}function te(a){try{localStorage.setItem(me,JSON.stringify(a))}catch(o){console.warn("Error saving notifications:",o)}}function Ue(a){return a.reduce((m,i)=>Math.max(m,i.id||0),0)+1}async function We(){const a=se();return Promise.resolve(a)}async function Be(a){const o=se(),i={id:Ue(o),case_number:a.case_number||`CASE-${new Date().getFullYear()}-${String(o.length+1).padStart(3,"0")}`,case_title:a.case_title||"",case_description:a.case_description||"",judge_id:a.judge_id||null,judge_name:a.judge_name||"",court:a.court||"",hearing_date:a.hearing_date||"",hearing_time:a.hearing_time||"09:00",trial_date:a.trial_date||"",trial_time:a.trial_time||"10:00",location:a.location||"",status:a.status||"programado",priority:a.priority||"media",funcionaries:a.funcionaries||[],witnesses:a.witnesses||[],jury:a.jury||[],created_by:a.created_by||1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return o.push(i),te(o),Promise.resolve(i)}async function qe(a,o){const m=se(),i=m.findIndex(N=>N.id===a);return i===-1?Promise.reject(new Error("Notification not found")):(m[i]={...m[i],...o,updated_at:new Date().toISOString()},te(m),Promise.resolve(m[i]))}async function Ye(a){const m=se().filter(i=>i.id!==a);return te(m),Promise.resolve({success:!0})}async function Ve(){try{return(await(await de(()=>import("./users-D6jQiQFN.js"),[],import.meta.url)).listUsers()).filter(m=>m.role==="funcionario"&&m.status==="activo")}catch(a){return console.error("Error loading funcionaries:",a),[]}}async function Ke(){try{return(await(await de(()=>import("./users-D6jQiQFN.js"),[],import.meta.url)).listUsers()).filter(m=>m.role==="civil"&&m.status==="activo")}catch(a){return console.error("Error loading citizens:",a),[]}}const Ge=({visible:a,onClose:o,onSave:m,initial:i=null})=>{const[N,C]=c.useState(""),[S,y]=c.useState(""),[D,I]=c.useState(""),[E,T]=c.useState(""),[$,J]=c.useState(""),[O,M]=c.useState("09:00"),[U,A]=c.useState(""),[W,F]=c.useState("10:00"),[B,P]=c.useState(""),[q,L]=c.useState("scheduled"),[Y,t]=c.useState("medium"),[l,f]=c.useState([]),[p,R]=c.useState([]),[k,H]=c.useState([]),[V,ue]=c.useState([]),[K,he]=c.useState([]),[xe,re]=c.useState(!1);c.useEffect(()=>{a&&(ge(),i?(C(i.case_title||""),y(i.case_description||""),I(i.judge_id||""),T(i.court||""),J(i.hearing_date||""),M(i.hearing_time||"09:00"),A(i.trial_date||""),F(i.trial_time||"10:00"),P(i.location||""),L(i.status||"scheduled"),t(i.priority||"medium"),f(i.officials||[]),R(i.witnesses||[]),H(i.jury||[])):je())},[a,i]);const je=()=>{C(""),y(""),I(""),T(""),J(""),M("09:00"),A(""),F("10:00"),P(""),L("scheduled"),t("medium"),f([]),R([]),H([])},ge=async()=>{re(!0);try{const[s,n]=await Promise.all([Ve(),Ke()]);ue(s),he(n)}catch(s){console.error("Error loading users:",s)}finally{re(!1)}},fe=()=>{f([...l,{user_id:"",name:"",role:"Lawyer"}])},pe=()=>{R([...p,{user_id:"",name:"",role:"Witness"}])},_e=()=>{H([...k,{user_id:"",name:"",role:"Juror"}])},ae=(s,n,r)=>{const h=[...l];if(h[s][n]=r,n==="user_id"&&r){const d=V.find(z=>z.id===parseInt(r));d&&(h[s].name=`${d.first_name} ${d.last_name}`)}f(h)},ie=(s,n,r)=>{const h=[...p];if(h[s][n]=r,n==="user_id"&&r){const d=K.find(z=>z.id===parseInt(r));d&&(h[s].name=`${d.first_name} ${d.last_name}`)}R(h)},ne=(s,n,r)=>{const h=[...k];if(h[s][n]=r,n==="user_id"&&r){const d=K.find(z=>z.id===parseInt(r));d&&(h[s].name=`${d.first_name} ${d.last_name}`)}H(h)},ve=s=>{f(l.filter((n,r)=>r!==s))},Ce=s=>{R(p.filter((n,r)=>r!==s))},ye=s=>{H(k.filter((n,r)=>r!==s))},be=s=>{if(s.preventDefault(),!N.trim()||!S.trim()){alert("Case title and description are required");return}const n=V.find(d=>d.id===parseInt(D)),r=n?`${n.first_name} ${n.last_name}`:"",h={case_title:N.trim(),case_description:S.trim(),judge_id:D?parseInt(D):null,judge_name:r,court:E.trim(),hearing_date:$,hearing_time:O,trial_date:U,trial_time:W,location:B.trim(),status:q,priority:Y,officials:l.filter(d=>d.user_id&&d.name),witnesses:p.filter(d=>d.user_id&&d.name),jury:k.filter(d=>d.user_id&&d.name)};m(h)},Ne=()=>l.map((s,n)=>e.jsxs(g,{className:"g-3 mb-3 align-items-end",children:[e.jsx(u,{md:5,children:e.jsxs(w,{label:"Official",value:s.user_id,onChange:r=>ae(n,"user_id",r.target.value),children:[e.jsx("option",{value:"",children:"Select official"}),V.map(r=>e.jsxs("option",{value:r.id,children:[r.first_name," ",r.last_name," - ",r.document]},r.id))]})}),e.jsx(u,{md:5,children:e.jsxs(w,{label:"Role",value:s.role,onChange:r=>ae(n,"role",r.target.value),children:[e.jsx("option",{value:"Lawyer",children:"Lawyer"}),e.jsx("option",{value:"Prosecutor",children:"Prosecutor"}),e.jsx("option",{value:"Defender",children:"Defender"}),e.jsx("option",{value:"Judge",children:"Judge"})]})}),e.jsx(u,{md:2,children:e.jsx(j,{color:"danger",variant:"outline",onClick:()=>ve(n),children:e.jsx(x,{icon:X})})})]},n)),Se=()=>p.map((s,n)=>e.jsxs(g,{className:"g-3 mb-3 align-items-end",children:[e.jsx(u,{md:5,children:e.jsxs(w,{label:"Witness",value:s.user_id,onChange:r=>ie(n,"user_id",r.target.value),children:[e.jsx("option",{value:"",children:"Select witness"}),K.map(r=>e.jsxs("option",{value:r.id,children:[r.first_name," ",r.last_name," - ",r.document]},r.id))]})}),e.jsx(u,{md:5,children:e.jsx(_,{label:"Role",value:s.role,onChange:r=>ie(n,"role",r.target.value),placeholder:"Eyewitness, Expert witness..."})}),e.jsx(u,{md:2,children:e.jsx(j,{color:"danger",variant:"outline",onClick:()=>Ce(n),children:e.jsx(x,{icon:X})})})]},n)),we=()=>k.map((s,n)=>e.jsxs(g,{className:"g-3 mb-3 align-items-end",children:[e.jsx(u,{md:5,children:e.jsxs(w,{label:"Jury Member",value:s.user_id,onChange:r=>ne(n,"user_id",r.target.value),children:[e.jsx("option",{value:"",children:"Select member"}),K.map(r=>e.jsxs("option",{value:r.id,children:[r.first_name," ",r.last_name," - ",r.document]},r.id))]})}),e.jsx(u,{md:5,children:e.jsx(_,{label:"Role",value:s.role,onChange:r=>ne(n,"role",r.target.value),placeholder:"Juror"})}),e.jsx(u,{md:2,children:e.jsx(j,{color:"danger",variant:"outline",onClick:()=>ye(n),children:e.jsx(x,{icon:X})})})]},n));return e.jsxs(Ie,{size:"xl",visible:a,onClose:o,children:[e.jsx(Te,{children:e.jsx(Je,{children:i?"Edit Judicial Notification":"New Judicial Notification"})}),e.jsxs(Fe,{onSubmit:be,children:[e.jsxs(Oe,{style:{maxHeight:"70vh",overflowY:"auto"},children:[e.jsx("h6",{className:"mb-3 text-primary",children:"Case Information"}),e.jsx(g,{className:"g-3",children:e.jsx(u,{md:12,children:e.jsx(_,{label:"Case Title *",placeholder:"Robbery in public space",value:N,onChange:s=>C(s.target.value),required:!0})})}),e.jsx("div",{className:"mt-3",children:e.jsx(Le,{label:"Case Description *",placeholder:"Detailed description of the case...",rows:"3",value:S,onChange:s=>y(s.target.value),required:!0})}),e.jsxs(g,{className:"g-3 mt-2",children:[e.jsx(u,{md:6,children:e.jsx(_,{label:"Court",placeholder:"First Criminal Court",value:E,onChange:s=>T(s.target.value)})}),e.jsx(u,{md:6,children:e.jsx(_,{label:"Location",placeholder:"Justice Palace, Room 4A",value:B,onChange:s=>P(s.target.value)})})]}),e.jsx("h6",{className:"mb-3 mt-4 text-primary",children:"Important Dates"}),e.jsxs(g,{className:"g-3",children:[e.jsx(u,{md:6,children:e.jsx(_,{label:"Hearing Date",type:"date",value:$,onChange:s=>J(s.target.value)})}),e.jsx(u,{md:6,children:e.jsx(_,{label:"Hearing Time",type:"time",value:O,onChange:s=>M(s.target.value)})})]}),e.jsxs(g,{className:"g-3 mt-2",children:[e.jsx(u,{md:6,children:e.jsx(_,{label:"Trial Date",type:"date",value:U,onChange:s=>A(s.target.value)})}),e.jsx(u,{md:6,children:e.jsx(_,{label:"Trial Time",type:"time",value:W,onChange:s=>F(s.target.value)})})]}),e.jsx("h6",{className:"mb-3 mt-4 text-primary",children:"Main Judge"}),e.jsx(g,{className:"g-3",children:e.jsx(u,{md:12,children:e.jsxs(w,{label:"Assigned Judge",value:D,onChange:s=>I(s.target.value),disabled:xe,children:[e.jsx("option",{value:"",children:"Select a judge"}),V.map(s=>e.jsxs("option",{value:s.id,children:[s.first_name," ",s.last_name," - ",s.document]},s.id))]})})}),e.jsx("h6",{className:"mb-3 mt-4 text-primary",children:"Case Officials"}),e.jsx(Z,{className:"mb-3",children:e.jsxs(ee,{children:[Ne(),e.jsxs(j,{color:"primary",variant:"outline",onClick:fe,children:[e.jsx(x,{icon:Q,className:"me-2"}),"Add Official"]})]})}),e.jsx("h6",{className:"mb-3 mt-4 text-primary",children:"Witnesses"}),e.jsx(Z,{className:"mb-3",children:e.jsxs(ee,{children:[Se(),e.jsxs(j,{color:"primary",variant:"outline",onClick:pe,children:[e.jsx(x,{icon:Q,className:"me-2"}),"Add Witness"]})]})}),e.jsx("h6",{className:"mb-3 mt-4 text-primary",children:"Jury Members"}),e.jsx(Z,{className:"mb-3",children:e.jsxs(ee,{children:[we(),e.jsxs(j,{color:"primary",variant:"outline",onClick:_e,children:[e.jsx(x,{icon:Q,className:"me-2"}),"Add Member"]})]})}),e.jsx("h6",{className:"mb-3 mt-4 text-primary",children:"Status and Priority"}),e.jsxs(g,{className:"g-3",children:[e.jsx(u,{md:6,children:e.jsxs(w,{label:"Status",value:q,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"postponed",children:"Postponed"})]})}),e.jsx(u,{md:6,children:e.jsxs(w,{label:"Priority",value:Y,onChange:s=>t(s.target.value),children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})})]}),e.jsx("div",{className:"mt-3",children:e.jsx("small",{className:"text-muted",children:"* Required fields"})})]}),e.jsxs(Me,{children:[e.jsx(j,{color:"secondary",onClick:o,children:"Cancel"}),e.jsxs(j,{type:"submit",color:"primary",children:[i?"Update":"Create"," Notification"]})]})]})]})},ls=()=>{const[a,o]=c.useState([]),[m,i]=c.useState(!0),[N,C]=c.useState(!1),[S,y]=c.useState(null),D={scheduled:{color:"primary",text:"Scheduled"},in_progress:{color:"warning",text:"In Progress"},completed:{color:"success",text:"Completed"},cancelled:{color:"danger",text:"Cancelled"},postponed:{color:"info",text:"Postponed"}},I={high:{color:"danger",text:"High"},medium:{color:"warning",text:"Medium"},low:{color:"success",text:"Low"}};c.useEffect(()=>{E()},[]);const E=async()=>{i(!0);try{const t=await We();o(t||[])}catch(t){console.error("Error fetching notifications:",t),o([])}finally{i(!1)}},T=async t=>{try{S?.id?await qe(S.id,t):await Be(t),C(!1),y(null),await E()}catch(l){console.error("Error saving notification:",l),alert("Error saving notification: "+l.message)}},$=async t=>{if(window.confirm("Are you sure you want to delete this judicial notification?"))try{await Ye(t),await E()}catch(l){console.error("Error deleting notification:",l),alert("Error deleting notification: "+l.message)}},J=t=>{y(t),C(!0)},O=()=>{y(null),C(!0)},M=()=>{C(!1),y(null)},U=t=>{const l=D[t]||{color:"secondary",text:t};return e.jsx(ce,{color:l.color,children:l.text})},A=t=>{const l=I[t]||{color:"secondary",text:t};return e.jsx(ce,{color:l.color,children:l.text})},W=t=>t?new Date(t).toLocaleDateString("en-US"):"Not set",F=t=>{const l=t.officials?.length||0,f=t.witnesses?.length||0,p=t.jury?.length||0;return l+f+p+(t.judge_id?1:0)},B=(t,l=50)=>t?t.length>l?`${t.substring(0,l)}...`:t:"",P=({date:t,time:l})=>e.jsx(b,{children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx(x,{icon:$e,className:"me-1 text-primary mt-1"}),e.jsxs("div",{children:[e.jsx("div",{children:W(t)}),l&&e.jsx("small",{className:"text-muted",children:l})]})]})}),q=({notification:t})=>{const l=t.officials?.length||0,f=t.witnesses?.length||0,p=t.jury?.length||0;return e.jsx(b,{children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx(x,{icon:Pe,className:"me-1 text-info mt-1"}),e.jsxs("div",{children:[e.jsxs("div",{children:[F(t)," people"]}),e.jsxs("small",{className:"text-muted",children:[l," official(s), ",f," witness(es), ",p," juror(s)"]})]})]})})},L=()=>e.jsxs("div",{className:"text-center py-4",children:[e.jsx(De,{color:"primary"}),e.jsx("div",{className:"mt-2",children:"Loading judicial notifications..."})]}),Y=()=>e.jsx("div",{className:"text-center py-5",children:e.jsxs("div",{className:"text-muted",children:[e.jsx(x,{icon:le,size:"3xl",className:"mb-3"}),e.jsx("h5",{children:"No judicial notifications found"}),e.jsx("p",{children:"Start by creating a new judicial notification."}),e.jsx(j,{color:"primary",onClick:O,children:"Create first notification"})]})});return e.jsxs(Ee,{fluid:!0,children:[e.jsx(g,{children:e.jsx(u,{children:e.jsxs(Z,{children:[e.jsx(Re,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h4",{className:"mb-0",children:[e.jsx(x,{icon:le,className:"me-2"}),"Judicial Notifications Management"]}),e.jsxs(j,{color:"primary",onClick:O,children:[e.jsx(x,{icon:Q,className:"me-2"}),"New Notification"]})]})}),e.jsx(ee,{children:m?e.jsx(L,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 text-muted",children:["Showing ",a.length," judicial notification(s)"]}),a.length>0?e.jsxs(ke,{hover:!0,responsive:!0,children:[e.jsx(He,{children:e.jsxs(oe,{children:[e.jsx(v,{children:"Case No."}),e.jsx(v,{children:"Case Title"}),e.jsx(v,{children:"Judge"}),e.jsx(v,{children:"Hearing Date"}),e.jsx(v,{children:"Trial Date"}),e.jsx(v,{children:"Participants"}),e.jsx(v,{children:"Priority"}),e.jsx(v,{children:"Status"}),e.jsx(v,{style:{width:"120px"},children:"Actions"})]})}),e.jsx(ze,{children:a.map(t=>e.jsxs(oe,{children:[e.jsx(b,{children:e.jsx("strong",{children:t.case_number})}),e.jsx(b,{children:e.jsxs("div",{children:[e.jsx("strong",{children:t.case_title}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:B(t.case_description)})]})}),e.jsx(b,{children:t.judge_name||"Not assigned"}),e.jsx(P,{date:t.hearing_date,time:t.hearing_time}),e.jsx(P,{date:t.trial_date,time:t.trial_time}),e.jsx(q,{notification:t}),e.jsx(b,{children:A(t.priority)}),e.jsx(b,{children:U(t.status)}),e.jsx(b,{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(j,{size:"sm",color:"primary",variant:"outline",onClick:()=>J(t),title:"Edit notification",children:e.jsx(x,{icon:Ae})}),e.jsx(j,{size:"sm",color:"danger",variant:"outline",onClick:()=>$(t.id),title:"Delete notification",children:e.jsx(x,{icon:X})})]})})]},t.id))})]}):e.jsx(Y,{})]})})]})})}),e.jsx(Ge,{visible:N,onClose:M,onSave:T,initial:S})]})};export{ls as default};
