import{r as l,j as e,C as z}from"./index-DUfxMsBG.js";import{c as U,d as m,a as D,b as Z,e as p,g as A,f as P}from"./auth-q2UnZPLo.js";import{C as G,a as J,b as V,c as $,d as R,e as K,f as Q,g as W,h as X}from"./cil-trash-2s-ugeRC.js";import{C as Y,a as C}from"./CFormInput-Cbdb-K5P.js";import{C as ee}from"./CAlert-ClAHz7tk.js";import{listUsers as se,changeUserRole as re,changeUserStatus as ae,deleteUser as te,updateUser as ne,createUser as le}from"./users-D6jQiQFN.js";import{C as ie,a as oe}from"./CCardBody-llveuZcH.js";import{C as ce}from"./CCardHeader-BnOoQjEp.js";import{C as de,a as me,b as M,c as h,d as ue,e as x}from"./CTable-RJjthtCV.js";import{f as he,g as xe,h as je,i as f,j as T,c as B}from"./DefaultLayout-DP4gFdW4.js";var ge=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M425.706,86.294A240,240,0,0,0,86.294,425.705,240,240,0,0,0,425.706,86.294ZM256,48A207.1,207.1,0,0,1,391.528,98.345L98.345,391.528A207.1,207.1,0,0,1,48,256C48,141.309,141.309,48,256,48Zm0,416a207.084,207.084,0,0,1-134.986-49.887l293.1-293.1A207.084,207.084,0,0,1,464,256C464,370.691,370.691,464,256,464Z' class='ci-primary'/>"];const fe=({visible:j,onClose:b,onSave:F,initial:n=null})=>{const[w,o]=l.useState(""),[u,c]=l.useState(""),[d,y]=l.useState(""),[v,S]=l.useState(""),[N,E]=l.useState(""),[g,_]=l.useState(""),[k,s]=l.useState("civil"),[a,t]=l.useState("activo"),[i,q]=l.useState({});l.useEffect(()=>{j&&(n?(o(n.document||""),c(n.first_name||""),y(n.last_name||""),S(n.password||""),E(n.number_phone||""),_(n.gmail||""),s(n.role||"civil"),t(n.status||"activo")):(o(""),c(""),y(""),S(""),E(""),_(""),s("civil"),t("activo")),q({}))},[j,n]);const L=()=>{const r={};return w.trim()||(r.document="Document is required"),u.trim()||(r.first_name="First name is required"),d.trim()||(r.last_name="Last name is required"),v.trim()||(r.password="Password is required"),v.length<6&&(r.password="Password must be at least 6 characters"),g.trim()||(r.gmail="Email is required"),g&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g)&&(r.gmail="Invalid email format"),N.trim()||(r.number_phone="Phone number is required"),q(r),Object.keys(r).length===0},I=r=>{if(r.preventDefault(),!L())return;const O={document:w.trim(),first_name:u.trim(),last_name:d.trim(),password:v.trim(),number_phone:N.trim(),gmail:g.trim(),role:k,status:a};F(O)},H=Object.keys(i).length>0;return e.jsxs(G,{size:"lg",visible:j,onClose:b,children:[e.jsx(J,{children:e.jsx(V,{children:n?"Edit User":"New User"})}),e.jsxs(Y,{onSubmit:I,children:[e.jsxs($,{children:[H&&e.jsx(ee,{color:"danger",className:"mb-3",children:"Please fix the errors below before submitting."}),e.jsxs(U,{className:"g-3",children:[e.jsx(m,{md:6,children:e.jsx(C,{label:"Document *",placeholder:"V-12345678",value:w,onChange:r=>o(r.target.value),invalid:!!i.document,feedback:i.document,required:!0})}),e.jsx(m,{md:6,children:e.jsx(C,{label:"Email *",type:"email",placeholder:"user@example.com",value:g,onChange:r=>_(r.target.value),invalid:!!i.gmail,feedback:i.gmail,required:!0})})]}),e.jsxs(U,{className:"g-3 mt-2",children:[e.jsx(m,{md:6,children:e.jsx(C,{label:"First Name *",placeholder:"John",value:u,onChange:r=>c(r.target.value),invalid:!!i.first_name,feedback:i.first_name,required:!0})}),e.jsx(m,{md:6,children:e.jsx(C,{label:"Last Name *",placeholder:"Doe",value:d,onChange:r=>y(r.target.value),invalid:!!i.last_name,feedback:i.last_name,required:!0})})]}),e.jsxs(U,{className:"g-3 mt-2",children:[e.jsx(m,{md:6,children:e.jsx(C,{label:"Password *",type:"password",placeholder:"Minimum 6 characters",value:v,onChange:r=>S(r.target.value),invalid:!!i.password,feedback:i.password,required:!0})}),e.jsx(m,{md:6,children:e.jsx(C,{label:"Phone Number *",placeholder:"0414-1234567",value:N,onChange:r=>E(r.target.value),invalid:!!i.number_phone,feedback:i.number_phone,required:!0})})]}),e.jsxs(U,{className:"g-3 mt-2",children:[e.jsx(m,{md:6,children:e.jsxs(R,{label:"Role *",value:k,onChange:r=>s(r.target.value),children:[e.jsx("option",{value:"civil",children:"Civil"}),e.jsx("option",{value:"funcionario",children:"Funcionary"}),e.jsx("option",{value:"administrador",children:"Administrator"})]})}),e.jsx(m,{md:6,children:e.jsxs(R,{label:"Status *",value:a,onChange:r=>t(r.target.value),children:[e.jsx("option",{value:"activo",children:"Active"}),e.jsx("option",{value:"suspendido",children:"Suspended"}),e.jsx("option",{value:"eliminado",children:"Deleted"})]})})]}),e.jsx("div",{className:"mt-3",children:e.jsx("small",{className:"text-muted",children:"* Required fields"})})]}),e.jsxs(K,{children:[e.jsx(D,{color:"secondary",onClick:b,children:"Cancel"}),e.jsxs(D,{type:"submit",color:"primary",children:[n?"Update":"Create"," User"]})]})]})]})},Ue=()=>{const[j,b]=l.useState([]),[F,n]=l.useState(!0),[w,o]=l.useState(!1),[u,c]=l.useState(null);l.useEffect(()=>{console.log("Users component mounted"),d()},[]);async function d(){console.log("Fetching users..."),n(!0);try{const s=await se();console.log("Users loaded:",s),b(s||[])}catch(s){console.error("Error fetching users:",s),b([])}finally{n(!1)}}async function y(s){console.log("Saving user:",s);try{u&&u.id?await ne(u.id,s):await le(s),o(!1),c(null),await d()}catch(a){console.error("Error saving user:",a),alert("Error saving user: "+a.message)}}async function v(s){if(window.confirm("Are you sure you want to delete this user?"))try{await te(s),await d()}catch(a){console.error("Error deleting user:",a),alert("Error deleting user: "+a.message)}}async function S(s,a){try{await ae(s,a),await d()}catch(t){console.error("Error changing user status:",t),alert("Error changing status: "+t.message)}}async function N(s,a){try{await re(s,a),await d()}catch(t){console.error("Error changing user role:",t),alert("Error changing role: "+t.message)}}const E=s=>{const t={administrador:{color:"danger",text:"Administrator",icon:P},funcionario:{color:"info",text:"funcionary",icon:B},civil:{color:"success",text:"Civil",icon:A}}[s]||{color:"secondary",text:s,icon:A};return e.jsxs(T,{color:t.color,children:[e.jsx(p,{icon:t.icon,className:"me-1"}),t.text]})},g=s=>{const t={activo:{color:"success",text:"Active"},suspendido:{color:"warning",text:"Suspended"},eliminado:{color:"danger",text:"Deleted"}}[s]||{color:"secondary",text:s};return e.jsx(T,{color:t.color,children:t.text})},_=s=>[{value:"administrador",label:"Administrator",icon:P},{value:"funcionario",label:"Funcionary",icon:B},{value:"civil",label:"Civil",icon:A}].filter(t=>t.value!==s),k=s=>[{value:"activo",label:"Active"},{value:"suspendido",label:"Suspended"},{value:"eliminado",label:"Deleted"}].filter(t=>t.value!==s);return e.jsxs(Z,{fluid:!0,children:[e.jsx(U,{children:e.jsx(m,{children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Users Management"}),e.jsxs(D,{color:"primary",onClick:()=>{c(null),o(!0)},children:[e.jsx(p,{icon:Q,className:"me-2"}),"New User"]})]})}),e.jsx(oe,{children:F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(z,{color:"primary"}),e.jsx("div",{className:"mt-2",children:"Loading users..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 text-muted",children:["Showing ",j.length," user(s)"]}),j.length>0?e.jsxs(de,{hover:!0,responsive:!0,children:[e.jsx(me,{children:e.jsxs(M,{children:[e.jsx(h,{children:"ID"}),e.jsx(h,{children:"Document"}),e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Email"}),e.jsx(h,{children:"Phone"}),e.jsx(h,{children:"Role"}),e.jsx(h,{children:"Status"}),e.jsx(h,{style:{width:"200px"},children:"Actions"})]})}),e.jsx(ue,{children:j.map(s=>e.jsxs(M,{children:[e.jsxs(x,{children:["#",s.id]}),e.jsx(x,{children:s.document}),e.jsx(x,{children:e.jsxs("strong",{children:[s.first_name," ",s.last_name]})}),e.jsx(x,{children:s.gmail}),e.jsx(x,{children:s.number_phone}),e.jsx(x,{children:E(s.role)}),e.jsx(x,{children:g(s.status)}),e.jsx(x,{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(he,{children:[e.jsx(xe,{color:"primary",size:"sm",variant:"outline",children:e.jsx(p,{icon:W})}),e.jsxs(je,{children:[e.jsx(f,{onClick:()=>{c(s),o(!0)},children:"Edit User"}),e.jsx(f,{divider:!0}),e.jsx(f,{header:!0,children:"Change Role"}),_(s.role).map(a=>e.jsxs(f,{onClick:()=>N(s.id,a.value),children:[e.jsx(p,{icon:a.icon,className:"me-2"}),"Change to ",a.label]},a.value)),e.jsx(f,{divider:!0}),e.jsx(f,{header:!0,children:"Change Status"}),k(s.status).map(a=>e.jsxs(f,{onClick:()=>S(s.id,a.value),children:[e.jsx(p,{icon:ge,className:"me-2"}),"Mark as ",a.label]},a.value))]})]}),e.jsx(D,{size:"sm",color:"danger",variant:"outline",onClick:()=>v(s.id),disabled:s.role==="administrador",children:e.jsx(p,{icon:X})})]})})]},s.id))})]}):e.jsx("div",{className:"text-center py-5",children:e.jsxs("div",{className:"text-muted",children:[e.jsx("h5",{children:"No users found"}),e.jsx("p",{children:"Start by adding a new user to the system."}),e.jsx(D,{color:"primary",onClick:()=>{c(null),o(!0)},children:"Add First User"})]})})]})})]})})}),e.jsx(fe,{visible:w,onClose:()=>{o(!1),c(null)},onSave:y,initial:u})]})};export{Ue as default};
