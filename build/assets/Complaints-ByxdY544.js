import{r as o,j as e,C as ce}from"./index-DUfxMsBG.js";import{c as O,d as x,e as w,a as S,b as de}from"./auth-q2UnZPLo.js";import{l as me}from"./officers-kgChqHOq.js";import{C as ue,a as he,b as pe,c as xe,d as q,h as X,e as ge,f as je,g as fe}from"./cil-trash-2s-ugeRC.js";import{C as ve,a as N}from"./CFormInput-Cbdb-K5P.js";import{C as Ce}from"./CFormTextarea-DH0Xj6EK.js";import{C as Q,a as ee}from"./CCardBody-llveuZcH.js";import{C as ye}from"./CProgress-CDNXbb7l.js";import{j as J}from"./DefaultLayout-DP4gFdW4.js";import{C as Ne}from"./CCardHeader-BnOoQjEp.js";import{C as Se,a as we,b as W,c as j,d as be,e as f}from"./CTable-RJjthtCV.js";var Ie=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M334.627,16H48V496H472V153.373ZM440,166.627V168H320V48h1.373ZM80,464V48H288V200H440V464Z' class='ci-primary'/>"],Me=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M40,472H472V40H40ZM440,348.142,328.628,236.769l46.6-46.6L440,254.935ZM72,72H440V209.68l-64.769-64.77L306,214.142l-100-100-134,134Zm0,221.4,134-134,234,234V440H72Z' class='ci-primary'/>"],Oe=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M153.456,472A136,136,0,0,1,57.289,239.834l196.6-196.6L276.52,65.857l-196.6,196.6A104,104,0,0,0,227,409.539L434.912,201.622A72,72,0,0,0,333.088,99.8L125.171,307.716a40,40,0,1,0,56.568,56.568L361.373,184.652,384,207.279,204.367,386.911A72,72,0,1,1,102.544,285.089L310.461,77.172A104,104,0,1,1,457.539,224.249L249.622,432.166A135.1,135.1,0,0,1,153.456,472Z' class='ci-primary'/>"],Pe=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M461,132,360,171.277V72H16V440H360V332.723L461,372h35V132Zm3,206.833-136-52.89V408H48V104H328V218.057l136-52.89Z' class='ci-primary'/>"];const Ee=({visible:s,onClose:r,onSave:c,initial:a=null})=>{const[v,u]=o.useState(""),[g,h]=o.useState(""),[C,b]=o.useState(""),[P,I]=o.useState(""),[E,n]=o.useState(""),[d,p]=o.useState(""),[D,z]=o.useState(""),[Y,F]=o.useState("Received"),[_,U]=o.useState("Medium"),[G,V]=o.useState(""),[R,M]=o.useState([]),[K,$]=o.useState([]),[T,B]=o.useState({});o.useEffect(()=>{s&&(se(),a?(u(a.title||""),h(a.description||""),b(a.complainantName||""),I(a.complainantPhone||""),n(a.complainantEmail||""),p(a.location||""),z(a.assignedOfficerId||""),F(a.status||"Received"),U(a.priority||"Medium"),V(a.incidentDate||""),M(a.evidence||[])):(u(""),h(""),b(""),I(""),n(""),p(""),z(""),F("Received"),U("Medium"),V(new Date().toISOString().split("T")[0]),M([])),B({}))},[s,a]);const se=async()=>{try{const l=(await me()).filter(i=>i.status==="Active");$(l)}catch(t){console.error("Error loading officers:",t),$([])}},ne=t=>new Promise(l=>{let i=0;const m=setInterval(()=>{i+=Math.random()*15,i>=100&&(i=100,clearInterval(m),l()),B(y=>({...y,[t]:Math.min(i,100)}))},200)}),ae=async t=>{const l=Array.from(t.target.files);for(const i of l){const m=Date.now()+Math.random(),y={id:m,name:i.name,type:i.type,size:i.size,url:URL.createObjectURL(i),uploadedAt:new Date().toISOString(),status:"uploading"};M(Z=>[...Z,y]),await ne(m),M(Z=>Z.map(k=>k.id===m?{...k,status:"completed"}:k))}t.target.value=""},ie=t=>{M(l=>l.filter(i=>i.id!==t)),B(l=>{const i={...l};return delete i[t],i})},re=t=>t.includes("image")?Me:t.includes("video")?Pe:Ie,oe=t=>{if(t===0)return"0 Bytes";const l=1024,i=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(t)/Math.log(l));return parseFloat((t/Math.pow(l,m)).toFixed(2))+" "+i[m]},le=t=>{if(t.preventDefault(),!v.trim()||!g.trim()||!C.trim()||!d.trim()){alert("Title, Description, Complainant Name, and Location are required");return}const l=K.find(y=>y.id===parseInt(D)),i=l?`${l.name} ${l.lastName}`:"",m={title:v.trim(),description:g.trim(),complainantName:C.trim(),complainantPhone:P.trim(),complainantEmail:E.trim(),location:d.trim(),assignedOfficerId:D?parseInt(D):null,assignedOfficerName:i,status:Y,priority:_,incidentDate:G,evidence:R.filter(y=>y.status==="completed")};c(m)};return e.jsxs(ue,{size:"lg",visible:s,onClose:r,children:[e.jsx(he,{children:e.jsx(pe,{children:a?"Edit Complaint":"New Complaint"})}),e.jsxs(ve,{onSubmit:le,children:[e.jsxs(xe,{style:{maxHeight:"70vh",overflowY:"auto"},children:[e.jsx("h6",{className:"mb-3 text-primary",children:"Complaint Information"}),e.jsx(O,{className:"g-3",children:e.jsx(x,{md:12,children:e.jsx(N,{label:"Complaint Title *",placeholder:"Brief description of the incident",value:v,onChange:t=>u(t.target.value),required:!0})})}),e.jsx("div",{className:"mt-3",children:e.jsx(Ce,{label:"Detailed Description *",placeholder:"Provide all relevant details of the incident...",rows:"4",value:g,onChange:t=>h(t.target.value),required:!0})}),e.jsxs(O,{className:"g-3 mt-2",children:[e.jsx(x,{md:6,children:e.jsx(N,{label:"Incident Date",type:"date",value:G,onChange:t=>V(t.target.value)})}),e.jsx(x,{md:6,children:e.jsx(N,{label:"Location *",placeholder:"Exact address of the incident",value:d,onChange:t=>p(t.target.value),required:!0})})]}),e.jsx("h6",{className:"mb-3 mt-4 text-primary",children:"Complainant Information"}),e.jsxs(O,{className:"g-3",children:[e.jsx(x,{md:6,children:e.jsx(N,{label:"Complainant Name *",placeholder:"Full name",value:C,onChange:t=>b(t.target.value),required:!0})}),e.jsx(x,{md:6,children:e.jsx(N,{label:"Phone Number",placeholder:"Contact number",value:P,onChange:t=>I(t.target.value)})})]}),e.jsx("div",{className:"mt-3",children:e.jsx(N,{label:"Email Address",type:"email",placeholder:"email@example.com",value:E,onChange:t=>n(t.target.value)})}),e.jsx("h6",{className:"mb-3 mt-4 text-primary",children:"Assignment and Status"}),e.jsxs(O,{className:"g-3",children:[e.jsx(x,{md:6,children:e.jsxs(q,{label:"Assigned Officer",value:D,onChange:t=>z(t.target.value),children:[e.jsx("option",{value:"",children:"Select an officer"}),K.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.lastName," - ",t.unit]},t.id))]})}),e.jsx(x,{md:3,children:e.jsxs(q,{label:"Priority",value:_,onChange:t=>U(t.target.value),children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Urgent",children:"Urgent"})]})}),e.jsx(x,{md:3,children:e.jsxs(q,{label:"Status",value:Y,onChange:t=>F(t.target.value),children:[e.jsx("option",{value:"Received",children:"Received"}),e.jsx("option",{value:"Under Investigation",children:"Under Investigation"}),e.jsx("option",{value:"Resolved",children:"Resolved"}),e.jsx("option",{value:"Closed",children:"Closed"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})})]}),e.jsx("h6",{className:"mb-3 mt-4 text-primary",children:"Multimedia Evidence"}),e.jsx(Q,{children:e.jsxs(ee,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(N,{type:"file",multiple:!0,accept:"image/*,video/*,.pdf,.doc,.docx,.txt",onChange:ae}),e.jsx("small",{className:"text-muted",children:"Supported formats: Images, Videos, PDF, Word documents, Text files"})]}),R.length>0&&e.jsxs("div",{children:[e.jsx("h6",{children:"Uploaded Files:"}),R.map(t=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2 p-2 border rounded",children:[e.jsxs("div",{className:"d-flex align-items-center flex-grow-1",children:[e.jsx(w,{icon:re(t.type),className:"me-2 text-primary"}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:t.status==="uploading"?"text-muted":"",children:t.name}),e.jsx("small",{className:"text-muted ms-2",children:oe(t.size)})]}),t.status==="uploading"&&T[t.id]!==void 0&&e.jsxs("div",{className:"mt-1",children:[e.jsx(ye,{value:T[t.id],size:"sm",className:"mb-1"}),e.jsxs("small",{className:"text-muted",children:["Uploading... ",Math.round(T[t.id]),"%"]})]}),t.status==="completed"&&e.jsx(J,{color:"success",className:"mt-1",children:"Uploaded"})]})]}),e.jsx(S,{size:"sm",color:"danger",variant:"outline",onClick:()=>ie(t.id),className:"ms-2",children:e.jsx(w,{icon:X})})]},t.id))]}),R.length===0&&e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx(w,{icon:Oe,size:"xl"}),e.jsx("div",{children:"No files uploaded yet"}),e.jsx("small",{children:"Upload images, videos, or documents as evidence"})]})]})}),e.jsx("div",{className:"mt-3",children:e.jsx("small",{className:"text-muted",children:"* Required fields"})})]}),e.jsxs(ge,{children:[e.jsx(S,{color:"secondary",onClick:r,children:"Cancel"}),e.jsxs(S,{type:"submit",color:"primary",children:[a?"Update":"Create"," Complaint"]})]})]})]})},te="mock_complaints_v1",A=[{id:1,title:"Street robbery",description:"Cell phone theft at the shopping center",complainantName:"Maria Gonzalez",complainantPhone:"0414-1112233",complainantEmail:"maria.gonzalez@email.com",location:"Main Avenue, XYZ Shopping Center",assignedOfficerId:1,assignedOfficerName:"Carlos Rodríguez",status:"Under Investigation",priority:"High",evidence:[{id:1,name:"security_camera.jpg",type:"image/jpeg",size:2048576,url:"https://example.com/evidence1.jpg",uploadedAt:new Date().toISOString()}],incidentDate:"2024-01-15",createdAt:new Date().toISOString()},{id:2,title:"Public property vandalism",description:"Damage to urban furniture in central park",complainantName:"Jose Lopez",complainantPhone:"0424-5556677",complainantEmail:"jose.lopez@email.com",location:"Central Park, North Zone",assignedOfficerId:2,assignedOfficerName:"Ana Martínez",status:"Received",priority:"Medium",evidence:[],incidentDate:"2024-01-14",createdAt:new Date().toISOString()}];function H(){try{const s=localStorage.getItem(te);if(!s)return L(A),A;const r=JSON.parse(s);return r&&r.length>0?r:A}catch(s){return console.error("Error loading complaints:",s),A}}function L(s){try{localStorage.setItem(te,JSON.stringify(s))}catch(r){console.warn("Error saving complaints:",r)}}function De(s){return s.reduce((c,a)=>Math.max(c,a.id||0),0)+1}async function Re(){const s=H();return Promise.resolve(s)}async function Ae(s){const r=H(),a={id:De(r),title:s.title||"",description:s.description||"",complainantName:s.complainantName||"",complainantPhone:s.complainantPhone||"",complainantEmail:s.complainantEmail||"",location:s.location||"",assignedOfficerId:s.assignedOfficerId||null,assignedOfficerName:s.assignedOfficerName||"",status:s.status||"Received",priority:s.priority||"Medium",evidence:s.evidence||[],incidentDate:s.incidentDate||new Date().toISOString().split("T")[0],createdAt:new Date().toISOString()};return r.push(a),L(r),Promise.resolve(a)}async function He(s,r){const c=H(),a=c.findIndex(v=>v.id===s);return a===-1?Promise.reject(new Error("Complaint not found")):(c[a]={...c[a],...r},L(c),Promise.resolve(c[a]))}async function Le(s){const c=H().filter(a=>a.id!==s);return L(c),Promise.resolve({success:!0})}const _e=()=>{const[s,r]=o.useState([]),[c,a]=o.useState(!0),[v,u]=o.useState(!1),[g,h]=o.useState(null);o.useEffect(()=>{console.log("Complaints component mounted"),C()},[]);async function C(){console.log("Fetching complaints..."),a(!0);try{const n=await Re();console.log("Complaints loaded:",n),r(n||[])}catch(n){console.error("Error fetching complaints:",n),r([])}finally{a(!1)}}async function b(n){console.log("Saving complaint:",n);try{g&&g.id?await He(g.id,n):await Ae(n),u(!1),h(null),await C()}catch(d){console.error("Error saving complaint:",d),alert("Error saving complaint: "+d.message)}}async function P(n){if(window.confirm("Are you sure you want to delete this complaint?"))try{await Le(n),await C()}catch(d){console.error("Error deleting complaint:",d),alert("Error deleting complaint: "+d.message)}}const I=n=>{const p={Received:{color:"primary",text:"Received"},"Under Investigation":{color:"warning",text:"Under Investigation"},Resolved:{color:"success",text:"Resolved"},Closed:{color:"secondary",text:"Closed"},Rejected:{color:"danger",text:"Rejected"}}[n]||{color:"secondary",text:n};return e.jsx(J,{color:p.color,children:p.text})},E=n=>{const p={Low:{color:"success",text:"Low"},Medium:{color:"warning",text:"Medium"},High:{color:"danger",text:"High"},Urgent:{color:"danger",text:"Urgent"}}[n]||{color:"secondary",text:n};return e.jsx(J,{color:p.color,children:p.text})};return e.jsxs(de,{fluid:!0,children:[e.jsx(O,{children:e.jsx(x,{children:e.jsxs(Q,{children:[e.jsx(Ne,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Complaints Management"}),e.jsxs(S,{color:"primary",onClick:()=>{h(null),u(!0)},children:[e.jsx(w,{icon:je,className:"me-2"}),"New Complaint"]})]})}),e.jsx(ee,{children:c?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ce,{color:"primary"}),e.jsx("div",{className:"mt-2",children:"Loading complaints..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 text-muted",children:["Showing ",s.length," complaint(s)"]}),s.length>0?e.jsxs(Se,{hover:!0,responsive:!0,children:[e.jsx(we,{children:e.jsxs(W,{children:[e.jsx(j,{children:"ID"}),e.jsx(j,{children:"Title"}),e.jsx(j,{children:"Complainant"}),e.jsx(j,{children:"Location"}),e.jsx(j,{children:"Assigned Officer"}),e.jsx(j,{children:"Priority"}),e.jsx(j,{children:"Status"}),e.jsx(j,{style:{width:"150px"},children:"Actions"})]})}),e.jsx(be,{children:s.map(n=>e.jsxs(W,{children:[e.jsxs(f,{children:["#",n.id]}),e.jsx(f,{children:e.jsx("strong",{children:n.title})}),e.jsxs(f,{children:[n.complainantName,e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:n.complainantPhone})]}),e.jsx(f,{children:e.jsx("small",{children:n.location})}),e.jsx(f,{children:n.assignedOfficerName||"Not assigned"}),e.jsx(f,{children:E(n.priority)}),e.jsx(f,{children:I(n.status)}),e.jsx(f,{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(S,{size:"sm",color:"primary",variant:"outline",onClick:()=>{h(n),u(!0)},children:e.jsx(w,{icon:fe})}),e.jsx(S,{size:"sm",color:"danger",variant:"outline",onClick:()=>P(n.id),children:e.jsx(w,{icon:X})})]})})]},n.id))})]}):e.jsx("div",{className:"text-center py-5",children:e.jsxs("div",{className:"text-muted",children:[e.jsx("h5",{children:"No complaints found"}),e.jsx("p",{children:"Start by adding a new complaint to the system."}),e.jsx(S,{color:"primary",onClick:()=>{h(null),u(!0)},children:"Add First Complaint"})]})})]})})]})})}),e.jsx(Ee,{visible:v,onClose:()=>{u(!1),h(null)},onSave:b,initial:g})]})};export{_e as default};
